<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="Description" content="Vijith Assar ">

<title>Vijith Assar • How To Block Genius.com Annotations</title>

<link rel="stylesheet" href="https://www.vijithassar.com/blog/wp-content/themes/vijithassar/style.css" type="text/css" media="screen">

<link rel="alternate" type="application/rss+xml" title="Posts" href="/feeds/blog.php">
<link rel="alternate" type="application/rss+xml" title="Comments" href="/feeds/comments.php">

<link rel="pingback" href="https://www.vijithassar.com/blog/xmlrpc.php">

<link rel="dns-prefetch" href="//www.vijithassar.com">
<link rel="alternate" type="application/rss+xml" title="Vijith Assar » How To Block Genius.com Annotations Comments Feed" href="https://www.vijithassar.com/2641/how-to-block-genius-annotations/feed">
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.10.0 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.10.0';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-1835380-1';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-1835380-1', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>
<!-- / Google Analytics by MonsterInsights -->
<link rel="stylesheet" id="wp-block-library-css" href="https://www.vijithassar.com/blog/wp-includes/css/dist/block-library/style.min.css?ver=5.0.15" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,pdf,ppt,zip,xls,docx,pptx,xlsx","inbound_paths":"[]","home_url":"https:\/\/www.vijithassar.com","hash_tracking":"false"};
/* ]]> */
</script>
<script type="text/javascript" src="https://www.vijithassar.com/blog/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js?ver=7.10.0"></script>
<link rel="https://api.w.org/" href="https://www.vijithassar.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.vijithassar.com/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.vijithassar.com/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Audio Metadata" href="https://www.vijithassar.com/2630/audio-metadata">
<link rel="next" title="Web Safe" href="https://www.vijithassar.com/2712/web-safe">
<meta name="generator" content="WordPress 5.0.15">
<link rel="canonical" href="https://www.vijithassar.com/2641/how-to-block-genius-annotations">
<link rel="shortlink" href="https://www.vijithassar.com/?p=2641">
<link rel="alternate" type="application/json+oembed" href="https://www.vijithassar.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.vijithassar.com%2F2641%2Fhow-to-block-genius-annotations">
<link rel="alternate" type="text/xml+oembed" href="https://www.vijithassar.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.vijithassar.com%2F2641%2Fhow-to-block-genius-annotations&amp;format=xml">

</head>

<body data-rsssl="1" class="post-template-default single single-post postid-2641 single-format-standard">

<div id="wrapper">

  <div id="header">
  	<div id="headerimg">
  		<h1><a href="https://www.vijithassar.com/">Vijith Assar</a></h1>
  		<div class="description"></div>
  	</div>
  </div>

<div id="content">
  
    
  	      
  		<div id="post-2641" class="post-2641 post type-post status-publish format-standard has-post-thumbnail hentry category-technology tag-genius tag-php tag-wordpress">
  
        <h2 class="title">
          
    		      		  
    		        		  How To Block Genius.com Annotations      		    		  
    		  
        </h2>
  		  
  			    		
    		<div class="entry">

      		      		  <img width="600" height="541" src="https://www.vijithassar.com/blog/wp-content/uploads/2016/04/dunce.jpg" class="attachment-loop size-loop wp-post-image" alt="" srcset="https://www.vijithassar.com/blog/wp-content/uploads/2016/04/dunce.jpg 600w, https://www.vijithassar.com/blog/wp-content/uploads/2016/04/dunce-300x271.jpg 300w" sizes="(max-width: 600px) 100vw, 600px">    				<p><em>Update, 2016.05.25: I’d recommend using <a href="https://github.com/vijithassar/genius-blender">Genius Blender</a>, a simple JavaScript one-liner, over the methods described below. You can read more about the security issues surrounding Genius in <a href="http://www.theverge.com/2016/5/25/11505454/news-genius-annotate-the-web-content-security-policy-vulnerability">my new article for the Verge</a>.</em></p>

<p>Over the weekend I wrote a tool to <a href="http://github.com/vijithassar/genius-defender">break the annotation functionality</a> of <a href="http://genius.com">genius.com</a>.</p>

<p><strong>Slow down. You wrote a what to do what to who now?</strong></p>

<p>Genius, formerly known as Rap Genius, is a web site that allows users to annotate blocks of text that appear on other sites. It’s very cool technology; you can just visit any page on the internet using a Genius redirect link, and it will show up with all sorts of additional information which has already been appended by other people. I wrote some code which lets site owners break the Genius annotations for their site, as well as a WordPress plugin which makes that code much easier to use.</p>

<p><strong>If it’s cool, why do you want to break it?</strong></p>

<p>There are two sides to that coin. The existence of the technology they’ve developed should be concerning to anybody who wants to put something on the internet. Not everything needs or deserves freeform annotation by users, and some things – some people – may be actively or disproportionately harmed by it. Genius has made special arrangements with some sites, such as the New York Times (which is also my employer), but hasn’t provided a way for smaller users to either opt in or opt out. This means they’re effectively forcing it on everyone.</p>

<p>I’m also firmly of the opinion that we’ll all be better off if functionality like this is handled by a standards body like the <a href="https://www.w3.org/annotation/">W3C</a>, or a non-profit like the <a href="https://wikimediafoundation.org/wiki/Home">WikiMedia Foundation</a>, or at least an open-source software project. Annotations are a pretty fundamental expression of the nonlinear ways we talk, write, and think, so I’m nervous about the possibility that the content and mechanisms could end up owned by a single for-profit tech startup.</p>

<p><strong>Why did you do this now?</strong></p>

<p>A few days ago <a href="https://twitter.com/brosandprose">Ella Dawson</a> wrote a <a href="https://ellacydawson.wordpress.com/2016/03/25/how-news-genius-silences-writers/">very upsetting blog post</a> about how Genius was functionally equivalent to forcing crude, violent, or hateful user comments onto a web site she created as a safe space to write about the sensitive work she does. When she reached out to Genius for help, the solution they suggested was “don’t look at the annotations.” This bothered me, so I stayed up all night tinkering and figured out how to make a defensive tool.</p>

<span id="more-2641"></span>

<p>Actually, you know what? Let me just quote Ella’s post, which you should really <a href="https://ellacydawson.wordpress.com/2016/03/25/how-news-genius-silences-writers/">go read in its entirety</a>:</p>

<blockquote>

<p>A creator receives no notification if someone has annotated their content. Opening my post using Genius was like discovering graffiti over some of my most personal work. Annotations display more like passive aggressive Post-It notes, but for someone who has been gaslit by partners, diminished by journalists, and harassed by mobs online, Genius annotations are an invasive violation.</p>

<p>…</p>

<p>I am nervous to publish this post because I know it will be annotated, and not in good faith. I am afraid to talk about how Genius can be used for harassment and abuse because Genius’s code offers no way for me to protect myself from the harassment and abuse I will receive for writing about it. Considering one of the people who annotated my blog is a News Genius editor, I’m not confident we agree on what harassment and abuse even is.</p>

<p>…</p>

<p>News Genius was probably created as a way to speak truth to power, but it has incredible potential to punch down. I am not a highly paid journalist at a huge publication; I am a survivor with a blog. You can hate-read my content all you want—I know that is a risk of being a person who says things on the Internet. But when you create a tool that pastes commentary directly on top of my work without letting me opt-in and without providing a way for people to turn off the annotation on their pages, you are being irresponsible. You are ignoring the potential your tool has to be abused, and you are not anticipating the real harm your tool can do. News Genius adds one more way for people on the Internet to be made unsafe. The potential it has to intimidate and silence marginalized voices needs to be recognized. Snarky journalists are not who I am afraid of. A tool that allows my abusive ex-boyfriend to interact with me and my content is a tool that should not exist.</p>

<p>When I reached out to Genius and News Genius to ask how I could opt-out of annotations on my website, I was told to not use the Genius URL or its extensions. As I had not downloaded the extension in the first place, their advice was basically just <strong>don’t look at the annotations</strong>.</p>

</blockquote>

<p>That response is completely unacceptable, both as a customer support exchange and as a general guiding corporate principle. Harassment is a huge problem on the internet; even massive tech companies like Facebook and Twitter still have trouble with it, and they <em>built and control their own products</em>. The annotation functionality Genius provides <em>just piggybacks on other things</em> that you and your friends build, write, and post, so the bar should be even higher. I hope the existence of this code will force them to step up and dedicate substantial resources to handling this issue.</p>

<p><strong>This is great! You have saved us all from certain doom!</strong></p>

<p>Not so fast. There are still some weaknesses that would make it easy for Genius to undermine this tool if they so desired. I think that would be a horribly fucked up thing for them to do, but it’s certainly within the realm of possibility. We’ll get to all that in a minute.</p>

<p><strong>How do I use it?</strong></p>

<p>Code and instructions for developers who want to implement the text filter are <a href="http://github.com/vijithassar/genius-defender">posted on GitHub</a>, and it’s very easy to rebuild the same logic for additional programming languages. If you have a WordPress blog, you can also just upload the files and it should automatically appear as a plugin in your admin settings (although you can only do this if you have a <a href="https://en.support.wordpress.com/com-vs-org/">self-hosted</a> site, rather than one provided by the <a href="https://wordpress.com/">WordPress.com</a> service). There’s also a <a href="https://github.com/vijithassar/genius-defender-js">simpler JavaScript version</a> available for use in <a href="http://nodejs.org">Node.js</a>.</p>

<p><strong>How does it work?</strong></p>

<p>Many thanks to Genius CEO <a href="https://twitter.com/dumbnamenumbers">Tom Lehman</a> for explaining precisely how to break Genius! A few months back, he gave a talk at their now-defunct <a href="http://code.genius.com">networking event for software engineers</a> in which he explained the text-matching algorithm. Its vulnerabilities became apparent with a little digging.</p>

<p><a href="https://www.youtube.com/watch?v=FJyqfRcyYIQ">Here’s the talk</a>:</p>

<p><iframe src="https://www.youtube.com/embed/FJyqfRcyYIQ" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>

<p>But hey, you don’t actually have to watch it! There’s a lot of talk about the <a href="https://en.wikipedia.org/wiki/Bitap_algorithm">Bitap algorithm</a> and <a href="https://www.npmjs.com/package/diff-match-patch">diff-match-patch</a>, but as I started reading up on both, I quickly came to the realization that it would be much easier to tear it all down than it was to build. I didn’t actually have to dive too deep once I realized that this all essentially depends on <em>sequences of characters</em>. When we screw with that, Genius falls apart immediately.</p>

<p><strong>Sequences of characters?</strong></p>

<p>Right, okay, maybe I should explain in greater detail what this code <em>actually does</em>. When you visit a Genius redirect link, well, there’s really nothing I can do for ya, because I can’t access their servers. What we can do, however, is make the material they’re trying to annotate incompatible with the way they do annotations.</p>

<p>In order to be useful, an annotation needs to have a reference point – in the talk above, Tom refers to them as “anchors.” These are the passages of text you click on to reveal the annotations; Genius displays them in yellow. Tom’s talk goes into some detail about how they connect annotations to anchors, which is a non-trivial problem. Those algorithms I mentioned are basically ways to train a computer how to continue to recognize text <em>even after it changes</em> – for example, if you edit a word in the middle of a sentence. They work by measuring character sequences. That is a very easy thing to destroy if you’re willing to be extremely reckless.</p>

<p><strong>Uh oh.</strong></p>

<p>Yeah.</p>

<p><strong>So?</strong></p>

<p>Buckle up, this is where it gets ugly.</p>

<p>The Genius text-matching algorithm works because it keeps track of characters that appear in succession, so even if some of the content changes, it still has an overall picture of what’s going on. It assigns weighted values to the character matches, and then calculates the most likely annotation anchor based on those values. All we need to do is prevent successive character matches.</p>

<p><strong>Surely you don’t mean…</strong></p>

<p>This code works by rewriting the original text using patterns generated randomly on the fly, injecting extra characters everywhere (I labeled them “wrenches” in the code) until the Genius servers decide it is completely incoherent and they don’t know where to put any of the annotations. But the original content is still readable by people, because all those extra characters are invisible!</p>

<p><strong>Oh my, that sounds completely unreasonable!</strong></p>

<p>Totally, in several different ways. As a developer, I consider this tool a totally insane thing to have to had to build in the first place, because it is completely counterproductive. The extra characters increase the size of the pages, so they take longer to serve over a network. It doesn’t work with screen readers, unfairly breaking access for the visually impaired. And obviously it should not be incumbent upon the <em>entire internet</em> to alter all existing content in order to work around Genius.</p>

<p>But hey, it’s something. Humans can still read the text. It’s still copy/paste friendly in most cases – works fine in both Microsoft Word and Google Docs, though you might see the extra characters if you copy and paste from an obscured passage on a web page into a code editor. It might even be possible to write a reverse implementation of this in JavaScript, so the page is rendered with scrambling and then unscrambled by the user’s browser UI; in that case, the <em>only people seeing the scrambled content would be Genius</em> and other would-be scrapers.</p>

<p>And this all happens on the fly, at the last minute, just before the web page is rendered onto the screen, so the original text upstream can remain untouched. Hopefully eventually you will be able to switch back to just rendering that again, once Genius starts providing a more sensible way to opt out.</p>

<p><strong>Can Genius do anything about this?</strong></p>

<p>Yes, this is just a small token step in an arms race I’m probably destined to lose. <del>They could disable this in a heartbeat simply by stripping out the invisible characters before performing their text-matching analyses.</del> (Update: <a href="http://genius.it/8896749/www.vijithassar.com/2641/how-to-block-genius-annotations">not true</a>, per Genius engineering lead Mat Brown.) That would defeat this method, but it would also be a <em>horrific moral failing</em> on the company’s part. They’d be actively overruling users who have identified themselves as vulnerable and taken substantial measures to remove their material, simply because they feel entitled to co-opt the whole world’s content.</p>

<p>In other words, if at some point in the future you try to use this code and it no longer subverts the annotations, there’s a good chance you should be absolutely livid. That would likely mean that Genius has decided to specifically reverse this text scrambling method in order to force their product on, I don’t know, rape survivors and suicidal people and whoever else had previously opted out for reasons Genius surely will not have responsibly investigated. (Further reading: <a href="https://medium.com/humane-tech/against-don-t-read-the-comments-aee43ce515b9">regarding “don’t read the comments”</a>.)</p>

<p>To be clear: as far as I can tell this code breaks the primary algorithm Genius is built on, and they can only beat it by deliberately doing something despicable. Let’s see!</p>

<p><strong>I tried it, but some Genius stuff still shows up in yellow?</strong></p>

<p>Well, yeah, sort of. As I said, I can’t change anything about what happens when you visit a page loaded through the Genius server. This code breaks their ability to attach the annotations to text on the page, but Genius has apparently not considered the possibility that their fancy algorithm will completely fail to match, so they didn’t build a failsafe that suppresses the annotations entirely when that is the case. (This is a strange omission, because it isn’t just a weird edge case relevant to nerds writing code to deliberately scramble the content– what if someone completely swaps out the page text for something new?)</p>

<p>Because I suspect they did not consider the possibility of this catastrophic failure, one or more Genius annotations may still appear in your scrambled text, but they will highlight nonsensical passages which will change every time the page reloads. Maybe this is actually better, though, since a broken user-facing product makes the company look even worse than an outright block.</p>

<p><strong>Is this really the best way to go about it?</strong></p>

<p>Maybe not. It would also be entirely possible to block Genius using JavaScript – you could write a script to delete your own page content if viewed through their redirects, or try to strip out their special «genius_referent» tags or something. But those approaches would have to be implemented client-side, and they wouldn’t affect the ability to collect the annotations in the first place. I think this tool is doing something deeper by providing a way to make text <em>fundamentally un-Genius-able</em>, and maybe that will prove more useful in the long run.</p>

<p><strong>What would you like Genius to do instead?</strong></p>

<p>There are many ways to solve this problem and empower the users, so if Genius hasn’t implemented any of them, it’s a deliberate decision. I don’t really care how they get there. Seems like it would be easy enough for them to start respecting <a href="http://www.robotstxt.org/">robots.txt</a>, a simple and universal standard used to send opt-out signals to search engines about what the site owner would like them to both include and ignore. Respecting robots.txt is voluntary, but it is one of the signs of a responsible technology company.</p>

<p><strong>What now?</strong></p>

<p>The code is completely free and open without any licensing restrictions whatsoever, so any company or site owner can use it, <a href="https://github.com/vijithassar/no-genius#fork-destination-box">fork it</a>, re-implement it in other languages, and customize the logic. Anybody who does the latter creates a <em>new scrambling pattern</em> which Genius will have to specifically devote engineering resources to un-scrambling! I’m not going to win the arms race on my own, but maybe with the help of every interested site owner on the internet? This is why we open source things.</p>

<p>Look, I don’t think Genius annotations are inherently bad — they’re perfectly innocuous in most contexts, and cool in a small handful. But at their core, they scrape content, and thus are <em>unquestionably parasitic</em>. Unilaterally forcing that on the entire internet through a sin of omission is not a mature or reasonable way to treat the rest of the world.</p>

<h3>More</h3>

<a href="http://motherboard.vice.com/read/theres-now-a-script-to-block-genius-from-annotating-your-website">Motherboard</a><br>
<a href="http://observer.com/2016/03/genius-defender-vijith-assar/">Observer</a><br>
<a href="http://www.vox.com/2016/3/31/11336852/genius-annotation-controversy">Vox</a><br>
<a href="http://recode.net/2016/03/28/the-company-formerly-known-as-rap-genius-is-once-again-enmeshed-in-controversy/">Recode</a><br>
<a href="http://www.capitalnewyork.com/article/media/2016/03/8595178/genius-adds-report-abuse-button-following-criticism">Politico</a><br>
<a href="http://www.dailydot.com/technology/genius-annotations-online-harrassment/">The Daily Dot</a><br>
<a href="http://nymag.com/following/2016/03/whats-genius-and-why-are-some-worried.html">New York</a><br>
<a href="http://fortune.com/2016/03/30/genius-harassment/">Fortune</a><br>
<a href="http://technical.ly/brooklyn/2016/03/29/genius-created-new-tool-annotating-peoples-articles-ho-boy-go/">Technically Brooklyn</a><br>      		
  			</div>
  			
  			    			<div class="metadata">
    				<div class="date">
    				  Posted: Monday, March 28th, 2016 at 11:45 am    				</div>
    				<div class="tags">
      				Tags: <a href="https://www.vijithassar.com/tag/genius" rel="tag">Genius</a>, <a href="https://www.vijithassar.com/tag/php" rel="tag">PHP</a>, <a href="https://www.vijithassar.com/tag/wordpress" rel="tag">WordPress</a><br>    				</div>
    				<div class="categories">
      				Categories: <a href="https://www.vijithassar.com/category/technology" rel="category tag">Technology</a><br>
    				</div>
    				    			</div>
    		  
  		</div>
  
  	
    
	<div class="pagednavigation">
			<div class="olderposts">
			  			</div>
			<div class="newerposts">
			  			</div>
	</div>
  	
</div>

			<div id="footer">
			</div>
			<script type="text/javascript" src="https://www.vijithassar.com/blog/wp-includes/js/wp-embed.min.js?ver=5.0.15"></script>
		</div>
	
</body></html>
